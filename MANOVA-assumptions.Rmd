---
title: "MANOVA assumptions"
output: html_document
date: "2022-08-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(tidyverse)
library(readxl)
library(officer)
library(flextable)
library(extrafont)
library(writexl)
library(rstatix)
library(corrr)
library(corrplot)
library(car)
```

```{r}
SA3_noout <- read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\SA3_noout.xlsx")
```


```{r}
str(SA3_noout)
SA3_num <- select_if(SA3_noout, is.numeric)
```


```{r}
correl <- correlate(SA3_num)
correl
```


```{r, fig.height=6, fig.width=8}
correl2 <- cor(SA3_num)
symnum(correl2)
corrplot(correl2, method = 'number')
```





checking assumptions using random variable: no transformation

```{r}
#make a random variable
#any number over 2 in place of 10
random <- rchisq(nrow(SA3_noout), 10)
#run a fake regression
fake <- lm(random~., data=SA3_noout[ , -1])
#create standardized residuals 
standardized <- rstandard(fake)
#create the fitted values 
fitted <- fake$fitted.values
```

```{r}
#homogeneity
#plot(fitted, standardized)
#abline(0,0)
#abline(v = 0)

#linearity
#qqnorm(standardized)
#abline(0,1)

#Normality
#hist(standardized)
```

```{r}
#creating dataframe for ggplot
temp1 <- data.frame(fitted, standardized)
str(temp1)
```

```{r}
 ggplot(data=temp1, aes(x=fitted, y=standardized))+
  geom_point(shape=1)+
  geom_hline(yintercept=0)+  
  theme_bw()+
  theme(text=element_text(family= "Times New Roman"))+
  labs(title="Residuals vs. Fitted Values of Randomly Generated Variable",
       subtitle = "No Data Transformation",
       y= "Standardized Residuals",
       x= "Fitted Values")

ggplot(data=temp1, aes(sample=standardized))+
  stat_qq()+
  stat_qq_line()+
  scale_x_continuous(n.breaks = 7)+
  #xlim(-3.5,3.5)+
  theme_bw()+
  theme(text=element_text(family= "Times New Roman"))+
  labs(title="QQPlot of Randomly Generated Variable",
       subtitle = "No Data Transformation",
       y= "Sample Quantiles",
       x= "Theoretical Quantities")

ggplot(data=temp1, aes(x=standardized))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="Normality of Randomly Generated Variable",
       subtitle = "No Data Transformation",
       y= "Count",
       x= "Standardized Residuals")
```







checking assumptions using random variable: log base 10 transformation

```{r}
#make a random variable
#any number over 2 in place of 7
randomlog10 <- rchisq(nrow(SA3_noout), 10)
#run a fake regression
fakelog10 <- lm(log(randomlog10, base=10)~., data=SA3_noout[ , -1])
#create standardized residuals 
standardizedlog10 <- rstandard(fakelog10)
#create the fitted values 
fittedlog10 <- fakelog10$fitted.values
```

```{r}
#homogeneity (unscaled)
#plot(fakelog10$fitted.values, standardizedlog10)
#abline(0,0)
#abline(v = 0)

##homogeneity (scaled)
#plot(fittedlog10, standardizedlog10)
#abline(0,0)
#abline(v = 0)

#linearity
#qqnorm(standardizedlog10)
#abline(0,1)

#Normality
#hist(standardizedlog10)


```
```{r}
#creating dataframe for ggplot
temp2 <- data.frame(fittedlog10, standardizedlog10)
str(temp2)
```

```{r}
 ggplot(data=temp2, aes(x=fittedlog10, y=standardizedlog10))+
  geom_point(shape=1)+
  geom_hline(yintercept=0)+  
  theme_bw()+
  theme(text=element_text(family= "Times New Roman"))+
  labs(title="Residuals vs. Fitted Values of Randomly Generated Variable",
       subtitle = "Log Base 10 Transformation",
       y= "Standardized Residuals",
       x= "Fitted Values")

ggplot(data=temp2, aes(sample=standardizedlog10))+
  stat_qq()+
  stat_qq_line()+
  scale_x_continuous(n.breaks = 7)+
  #xlim(-3.5,3.5)+
  theme_bw()+
  theme(text=element_text(family= "Times New Roman"))+
  labs(title="QQPlot of Randomly Generated Variable",
       subtitle = "Log Base 10 Transformation",
       y= "Sample Quantiles",
       x= "Theoretical Quantities")

ggplot(data=temp2, aes(x=standardizedlog10))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="Normality of Randomly Generated Variable",
       subtitle = "Log Base 10 Transformation",
       y= "Count",
       x= "Standardized Residuals")
```


checking assumptions using random variable: log base 10 transformation

```{r}
#make a random variable
#any number over 2 in place of 7
randomlog <- rchisq(nrow(SA3_noout), 10)
#run a fake regression
fakelog <- lm(log(randomlog)~., data=SA3_noout[ , -1])
#create standardized residuals 
standardizedlog <- rstandard(fakelog)
#create the fitted values 
fittedlog <- fakelog$fitted.values
```

```{r}
#homogeneity (unscaled)
#plot(fakelog$fitted.values, standardizedlog)
#abline(0,0)
#abline(v = 0)

##homogeneity (scaled)
#plot(fittedlog, standardizedlog)
#abline(0,0)
#abline(v = 0)

#linearity
#qqnorm(standardizedlog)
#abline(0,1)

#Normality
#hist(standardizedlog)

```
```{r}
#creating dataframe for ggplot
temp3 <- data.frame(fittedlog, standardizedlog)
str(temp3)
```

```{r}
 ggplot(data=temp3, aes(x=fittedlog, y=standardizedlog))+
  geom_point(shape=1)+
  geom_hline(yintercept=0)+  
  theme_bw()+
  theme(text=element_text(family= "Times New Roman"))+
  labs(title="Residuals vs. Fitted Values of Randomly Generated Variable",
       subtitle = "Log e Transformation",
       y= "Standardized Residuals",
       x= "Fitted Values")

ggplot(data=temp3, aes(sample=standardizedlog))+
  stat_qq()+
  stat_qq_line()+
  scale_x_continuous(n.breaks = 7)+
  #xlim(-3.5,3.5)+
  theme_bw()+
  theme(text=element_text(family= "Times New Roman"))+
  labs(title="QQPlot of Randomly Generated Variable",
       subtitle = "Log e Transformation",
       y= "Sample Quantiles",
       x= "Theoretical Quantities")

ggplot(data=temp3, aes(x=standardizedlog))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="Normality of Randomly Generated Variable",
       subtitle = "Log e Transformation",
       y= "Count",
       x= "Standardized Residuals")
```




checking assumptions using random variable: sqrt transformation

```{r}
#make a random variable
#any number over 2 in place of 7
randomsqrt <- rchisq(nrow(SA3_noout), 10)
#run a fake regression
fakesqrt <- lm(sqrt(randomsqrt)~., data=SA3_noout[ , -1])
#create standardized residuals 
standardizedsqrt <- rstandard(fakesqrt)
#create the fitted values 
fittedsqrt <- fakesqrt$fitted.values
```

```{r}
#homogeneity (unscaled)
#plot(fakesqrt$fitted.values, standardizedsqrt)
#abline(0,0)
#abline(v = 0)

##homogeneity (scaled)
#plot(fittedsqrt, standardizedsqrt)
#abline(0,0)
#abline(v = 0)

#linearity
#qqnorm(standardizedsqrt)
#abline(0,1)

#Normality
#hist(standardizedsqrt)


```

```{r}
#creating dataframe for ggplot
temp4 <- data.frame(fittedsqrt, standardizedsqrt)
str(temp4)
```

```{r}
 ggplot(data=temp4, aes(x=fittedsqrt, y=standardizedsqrt))+
  geom_point(shape=1)+
  geom_hline(yintercept=0)+  
  theme_bw()+
  theme(text=element_text(family= "Times New Roman"))+
  labs(title="Residuals vs. Fitted Values of Randomly Generated Variable",
       subtitle = "Square Root Transformation",
       y= "Standardized Residuals",
       x= "Fitted Values")

ggplot(data=temp4, aes(sample=standardizedsqrt))+
  stat_qq()+
  stat_qq_line()+
  scale_x_continuous(n.breaks = 7)+
  #xlim(-3.5,3.5)+
  theme_bw()+
  theme(text=element_text(family= "Times New Roman"))+
  labs(title="QQPlot of Randomly Generated Variable",
       subtitle = "Square Root Transformation",
       y= "Sample Quantiles",
       x= "Theoretical Quantities")

ggplot(data=temp4, aes(x=standardizedsqrt))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="Normality of Randomly Generated Variable",
       subtitle = "Square Root Transformation",
       y= "Count",
       x= "Standardized Residuals")
```




Checking for influencial measures in dataset

```{r}
#influencial observations (STAR 513: Lecture 5 examples)
# overwhelming to look at
inf_out <- influence.measures(fakesqrt)
# check out Cook's D (column 6)
sum(inf_out$is.inf[, 6])
```






Checking assumptions on actual MANOVA model: setup

```{r}
variables <- cbind(SA3_noout$AA_C, SA3_noout$BiW_C, SA3_noout$BiW_L, 
                   SA3_noout$GoSub_C, SA3_noout$NRB_L, SA3_noout$ProS_L,
                   SA3_noout$SelP_L, SA3_noout$SelM_L, SA3_noout$SnasM_C,
                   SA3_noout$SnasM_C, SA3_noout$TrSman_C, SA3_noout$TrTr_C,
                   SA3_noout$TrTr_L)


#part of Dr. Erin Buchanan's lecture, but Manova code returns error: Error in Anova.mlm(mod, ...) : model is singular
#lm_notransf <- lm(variables ~ gender*race_eth*age_group, data=SA3_noout,
                  #contrasts = list(gender=contr.sum, 
                                   #race_eth=contr.sum,
                                   #age_group=contr.sum))

#manova_notransf <- Manova(lm_notransf, type = "III")

```




Checking assumptions on actual MANOVA model: no transformation

```{r}



manova_out_nt <- manova(variables ~ gender*race_eth*age_group, data=SA3_noout)

fitted1 <- scale(manova_out_nt$fitted.values)

resid1 <- rstandard(manova_out_nt)

#homogeneity (unscaled)
plot(manova_out_nt$fitted.values, resid1)
abline(0,0)
abline(v = 0)

#homogeneity (scaled)
#plot(fitted1, resid1)
#abline(0,0)
#abline(v = 0)

#linearity
qqnorm(resid1)
abline(0,1, lty=2)

#normality
hist(resid1)
```


Checking assumptions on actual MANOVA model: log base 10 transformation

```{r}

manova_out_log10 <- manova(log(variables, base=10) ~ gender*race_eth*age_group, data=SA3_noout)


#fitted1_log10 <- scale(manova_out_log10$fitted.values)

resid1_log10 <- rstandard(manova_out_log10)

#homogeneity (unscaled)
plot(manova_out_log10$fitted.values, resid1_log10)
abline(0,0)
abline(v = 0)

#homogeneity (scaled)
#plot(fitted1_log10, resid1_log10)
#abline(0,0)
#abline(v = 0)

#linearity
qqnorm(resid1_log10)
abline(0,1, lty=2)

#normality
hist(resid1_log10)
```






Checking assumptions on actual MANOVA model: log transformation

```{r}

manova_out_log <- manova(log(variables) ~ gender*race_eth*age_group, data=SA3_noout)


#fitted1_log <- scale(manova_out_log$fitted.values)

resid1_log <- rstandard(manova_out_log)

#homogeneity (unscaled)
plot(manova_out_log$fitted.values, resid1_log)
abline(0,0)
abline(v = 0)

#homogeneity (scaled)
#plot(fitted1_log, resid1_log)
#abline(0,0)
#abline(v = 0)

#linearity
qqnorm(resid1_log)
abline(0,1, lty=2)

#normality
hist(resid1_log)
```

Checking assumptions on actual MANOVA model: sqrt transformation

```{r}

manova_out_sqrt <- manova(sqrt(variables) ~ gender*race_eth*age_group, data=SA3_noout)

#fitted1_sqrt <- scale(manova_out_sqrt$fitted.values)

resid1_sqrt <- rstandard(manova_out_sqrt)

#homogeneity (unscaled)
plot(manova_out_sqrt$fitted.values, resid1_sqrt)
abline(0,0)
abline(v = 0)

#homogeneity (scaled)
#plot(fitted1_sqrt, resid1_sqrt)
#abline(0,0)
#abline(v = 0)

#linearity
qqnorm(resid1_sqrt)
abline(0,1, lty=2)

#normality
hist(resid1_sqrt)
```






Levene's test, no transformation

```{r}
print("AA_C Levene Test")
leveneTest(AA_C ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("BiW_C Levene Test")
leveneTest(BiW_C ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("BiW_L Levene Test")
leveneTest(BiW_L ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("GoSub_C Levene Test")
leveneTest(GoSub_C ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("NRB_L Levene Test")
leveneTest(NRB_L ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("ProS_L Levene Test")
leveneTest(ProS_L ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SelP_L Levene Test")
leveneTest(SelP_L ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SelM_L Levene Test")
leveneTest(SelM_L ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SnasM_C Levene Test")
leveneTest(SnasM_C ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrSman_C Levene Test")
leveneTest(TrSman_C ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrTr_C Levene Test")
leveneTest(TrTr_C ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrTr_L Levene Test")
leveneTest(TrTr_L ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")
```




Levene's test, log base 10 transformation

```{r}
print("AA_C Levene Test: log base 10 transformation")
leveneTest(log(AA_C, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("BiW_C Levene Test: log base 10 transformation")
leveneTest(log(BiW_C, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("BiW_L Levene Test: log base 10 transformation")
leveneTest(log(BiW_L, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("GoSub_C Levene Test: log base 10 transformation")
leveneTest(log(GoSub_C, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("NRB_L Levene Test: log base 10 transformation")
leveneTest(log(NRB_L, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("ProS_L Levene Test: log base 10 transformation")
leveneTest(log(ProS_L, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SelP_L Levene Test: log base 10 transformation")
leveneTest(log(SelP_L, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SelM_L Levene Test: log base 10 transformation")
leveneTest(log(SelM_L, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SnasM_C Levene Test: log base 10 transformation")
leveneTest(log(SnasM_C, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrSman_C Levene Test: log base 10 transformation")
leveneTest(log(TrSman_C, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrTr_C Levene Test: log base 10 transformation")
leveneTest(log(TrTr_C, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrTr_L Levene Test: log base 10 transformation")
leveneTest(log(TrTr_L, base=10) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")
```





Levene's test, log transformation

```{r}
print("AA_C Levene Test: log transformation")
leveneTest(log(AA_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("BiW_C Levene Test: log transformation")
leveneTest(log(BiW_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("BiW_L Levene Test: log transformation")
leveneTest(log(BiW_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("GoSub_C Levene Test: log transformation")
leveneTest(log(GoSub_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("NRB_L Levene Test: log transformation")
leveneTest(log(NRB_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("ProS_L Levene Test: log transformation")
leveneTest(log(ProS_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SelP_L Levene Test: log transformation")
leveneTest(log(SelP_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SelM_L Levene Test: log transformation")
leveneTest(log(SelM_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SnasM_C Levene Test: log transformation")
leveneTest(log(SnasM_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrSman_C Levene Test: log transformation")
leveneTest(log(TrSman_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrTr_C Levene Test: log transformation")
leveneTest(log(TrTr_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrTr_L Levene Test: log transformation")
leveneTest(log(TrTr_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")
```





Levene's test, sqrt transformation

```{r}
print("AA_C Levene Test: sqrt transformation")
leveneTest(sqrt(AA_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("BiW_C Levene Test: sqrt transformation")
leveneTest(sqrt(BiW_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("BiW_L Levene Test: sqrt transformation")
leveneTest(sqrt(BiW_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("GoSub_C Levene Test: sqrt transformation")
leveneTest(sqrt(GoSub_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("NRB_L Levene Test: sqrt transformation")
leveneTest(sqrt(NRB_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("ProS_L Levene Test: sqrt transformation")
leveneTest(sqrt(ProS_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SelP_L Levene Test: sqrt transformation")
leveneTest(sqrt(SelP_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SelM_L Levene Test: sqrt transformation")
leveneTest(sqrt(SelM_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("SnasM_C Levene Test: sqrt transformation")
leveneTest(sqrt(SnasM_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrSman_C Levene Test: sqrt transformation")
leveneTest(sqrt(TrSman_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrTr_C Levene Test: sqrt transformation")
leveneTest(sqrt(TrTr_C) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")

print("TrTr_L Levene Test: sqrt transformation")
leveneTest(sqrt(TrTr_L) ~ gender*race_eth*age_group, data=SA3_noout, center=mean)
print("                       ")
```