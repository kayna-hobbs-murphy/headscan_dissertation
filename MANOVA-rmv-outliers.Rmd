---
title: "MANOVA outlier assessment"
output:
  word_document: default
  html_document: default
date: "2022-08-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(tidyverse)
library(readxl)
library(officer)
library(flextable)
library(extrafont)
library(writexl)
library(rstatix)
```




FOR EACH MEASURE: 



```{r table-function}
#times new roman tables
my_ft_theme <- function(ft, ...) {
  # Remove vertical cell padding
  ft <- padding(ft, padding.top = 0, padding.bottom = 0, part = "all")
  
  # Change font to TNR 11
  ft <- font(ft, fontname = "Times New Roman", part = "all")
  ft <- fontsize(ft, part = "all", size = 12)
  ft
}
```

```{r}
#remove identifiers and demographic data

headscan_full<-read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\headscan_full.xlsx")

headscan_full$AA_C <- headscan_full$AA_C *10
headscan_full$BGl_C <- headscan_full$BGl_C * 10
headscan_full$BiW_C <- headscan_full$BiW_C *10
headscan_full$BiW_L <- headscan_full$BiW_L *10
headscan_full$ChCh_C <- headscan_full$ChCh_C *10
headscan_full$GoSub_C <- headscan_full$GoSub_C *10
headscan_full$NRB_L <- headscan_full$NRB_L *10
headscan_full$ProA_L <- headscan_full$ProA_L *10
headscan_full$ProA_C <- headscan_full$ProA_C *10
headscan_full$ProS_C <- headscan_full$ProS_C *10
headscan_full$ProS_L <- headscan_full$ProS_L *10
headscan_full$SelP_C <- headscan_full$SelP_C *10
headscan_full$SelP_L <- headscan_full$SelP_L *10
headscan_full$SelDH_C <- headscan_full$SelDH_C *10
headscan_full$SelM_L <- headscan_full$SelM_L *10
headscan_full$SnasM_C <- headscan_full$SnasM_C *10
headscan_full$SmanM_C <- headscan_full$SmanM_C *10
headscan_full$SmanM_L <- headscan_full$SmanM_L *10
headscan_full$SnasM_L <- headscan_full$SnasM_L *10
headscan_full$TrHO_C <- headscan_full$TrHO_C *10
headscan_full$TrEJ_C <- headscan_full$TrEJ_C *10
headscan_full$TrGo_C <- headscan_full$TrGo_C *10
headscan_full$TrSel_C <- headscan_full$TrSel_C *10
headscan_full$TrSman_C <- headscan_full$TrSman_C *10
headscan_full$TrSnas_C <- headscan_full$TrSnas_C *10
headscan_full$TrTr_C <- headscan_full$TrTr_C *10
headscan_full$TrTr_L <- headscan_full$TrTr_L *10

headscan_full$gender <- as.factor(headscan_full$gender)
headscan_full$race_eth <- as.factor(headscan_full$race_eth)
headscan_full$age_group <- as.factor(headscan_full$age_group)

str(headscan_full)
```

```{r}
SA3_data <- headscan_full[c(1,2,4,5,7,8,12,14,16,17,25,27,28,31,32,33)]
```


```{r}
SA3_NAsums <- colSums(is.na(SA3_data))

SA3_NAprops <- colMeans(is.na(SA3_data))

SA3_NAprops1 <- as.data.frame(SA3_NAprops)
SA3_NAprops1 <- rownames_to_column(SA3_NAprops1, "var_name")
SA3_NAprops1 <- SA3_NAprops1 %>% slice(-c(1, 29:33))

SA3_NAsums1 <- as.data.frame(SA3_NAsums)
SA3_NAsums1 <- rownames_to_column(SA3_NAsums1, "var_name")
SA3_NAsums1 <- SA3_NAsums1 %>% slice(-c(1, 29:33))

SA3_NAs <- inner_join(SA3_NAprops1, SA3_NAsums1, by = "var_name", desc)

SA3_NAs$SA3_NAprops<- round(SA3_NAs$SA3_NAprops, digits=4)

SA3_NAs$var_name <- fct_reorder(SA3_NAs$var_name, SA3_NAs$SA3_NAsums, .desc=TRUE)

str(SA3_NAs$SA3_name)

#Size 12 Table TNR
flextable(SA3_NAs) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("NA values for each MANOVA Variable") %>% 
  autofit() %>% 
  set_header_labels(values = list(var_name = "Variable",
                                  SA3_NAprops = "Proportion of NA values",
                                  SA3_NAsums = "Count of NA values"))
```





```{r}
SA3_data1 <- SA3_data

#race/eth
SA3_data1$race_eth <-  
  recode_factor(SA3_data1$race_eth, 'AIAN'= "Other",
                'NHOPI' = "Other",
                'PTNS' = "Other")

#gender
SA3_data1$gender <-  
  recode_factor(SA3_data1$gender, 'Non-binary or Other'= "Other",
                'Prefer not to say' = "Other")

SA3_data1$gender[is.na(SA3_data1$gender)]="Other"


summary(SA3_data1)
```




#Dr. Erin Buchanan from Missouri State
If there were missing data categories over 20%, I could replace the data? According to manova-9 notes

Otherwise, it seems like I have to delete the missing values. I did this for PCA as well. 


```{r}

SA3_data2 <- SA3_data1 %>% drop_na()

sum(is.na(SA3_data1))

2016-1710
```
#306 observations were deleted when we dropped NAs. That is not bad considering there are 892 missing values

```{r}
str(SA3_data2)
```


Next, identify univariate outliers


```{r}
#AA_C
AA_C_out <- SA3_data2 %>% 
  identify_outliers(AA_C)

AA_C_out$extreme_overall <- AA_C_out$is.extreme

AA_C_out <- AA_C_out[c(1,2,19)]



AA_C_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(AA_C)

AA_C_out1$extreme_race_eth <- AA_C_out1$is.extreme

AA_C_out1 <- AA_C_out1[c(2,3,19)]




AA_C_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(AA_C)

AA_C_out2$extreme_gender <- AA_C_out2$is.extreme

AA_C_out2 <- AA_C_out2[c(2,3,19)]



AA_C_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(AA_C)

AA_C_out3$extreme_age <- AA_C_out3$is.extreme

AA_C_out3 <- AA_C_out3[c(2,3,19)]


AA_C_extreme <- full_join(AA_C_out, AA_C_out1, by=c('ID', 'AA_C'))
AA_C_extreme <- full_join(AA_C_extreme, AA_C_out2, by=c('ID', 'AA_C'))
AA_C_extreme <- full_join(AA_C_extreme, AA_C_out3, by=c('ID', 'AA_C'))

AA_C_extreme <- 
  filter(AA_C_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )


AA_C_extreme$extreme_overall <- as.character(AA_C_extreme$extreme_overall)
AA_C_extreme$extreme_race_eth <- as.character(AA_C_extreme$extreme_race_eth)
AA_C_extreme$extreme_gender <- as.character(AA_C_extreme$extreme_gender)
AA_C_extreme$extreme_age <- as.character(AA_C_extreme$extreme_age)
           
AA_C_extreme[is.na(AA_C_extreme)]="Not Outlier"

#Size 12 Table TNR
flextable(AA_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("AA_C Extreme Outliers (mean=61.25mm)") 
#%>% set_header_labels(values = list(AA_C = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(AA_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("AA_C Extreme Outliers (mean=61.25mm)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(AA_C = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=AA_C))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="AA_C Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```

```{r}
#BiW_C
BiW_C_out <- SA3_data2 %>% 
  identify_outliers(BiW_C)

BiW_C_out$extreme_overall <- BiW_C_out$is.extreme

BiW_C_out <- BiW_C_out[c(1,3,19)]



BiW_C_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(BiW_C)

BiW_C_out1$extreme_race_eth <- BiW_C_out1$is.extreme

BiW_C_out1 <- BiW_C_out1[c(2,4,19)]




BiW_C_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(BiW_C)

BiW_C_out2$extreme_gender <- BiW_C_out2$is.extreme

BiW_C_out2 <- BiW_C_out2[c(2,4,19)]



BiW_C_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(BiW_C)

BiW_C_out3$extreme_age <- BiW_C_out3$is.extreme

BiW_C_out3 <- BiW_C_out3[c(2,4,19)]


BiW_C_extreme <- full_join(BiW_C_out, BiW_C_out1, by=c('ID', 'BiW_C'))
BiW_C_extreme <- full_join(BiW_C_extreme, BiW_C_out2, by=c('ID', 'BiW_C'))
BiW_C_extreme <- full_join(BiW_C_extreme, BiW_C_out3, by=c('ID', 'BiW_C'))

BiW_C_extreme <- 
  filter(BiW_C_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )


BiW_C_extreme$extreme_overall <- as.character(BiW_C_extreme$extreme_overall)
BiW_C_extreme$extreme_race_eth <- as.character(BiW_C_extreme$extreme_race_eth)
BiW_C_extreme$extreme_gender <- as.character(BiW_C_extreme$extreme_gender)
BiW_C_extreme$extreme_age <- as.character(BiW_C_extreme$extreme_age)
           
BiW_C_extreme[is.na(BiW_C_extreme)]="Not Outlier"


#Size 12 Table TNR
flextable(BiW_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("BiW_C Extreme Outliers (mean=133.4mm)") 
#%>% set_header_labels(values = list(BiW_C = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(BiW_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("BiW_C Extreme Outliers (mean=133.4mm)") %>% 
  fit_to_width(7.5) 
#%>% set_header_labels(values = list(BiW_C = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=BiW_C))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="BiW_C Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```

```{r}
#BiW_L
BiW_L_out <- SA3_data2 %>% 
  identify_outliers(BiW_L)

BiW_L_out$extreme_overall <- BiW_L_out$is.extreme

BiW_L_out <- BiW_L_out[c(1,4,19)]



BiW_L_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(BiW_L)

BiW_L_out1$extreme_race_eth <- BiW_L_out1$is.extreme

BiW_L_out1 <- BiW_L_out1[c(2,5,19)]




BiW_L_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(BiW_L)

BiW_L_out2$extreme_gender <- BiW_L_out2$is.extreme

BiW_L_out2 <- BiW_L_out2[c(2,5,19)]



BiW_L_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(BiW_L)

BiW_L_out3$extreme_age <- BiW_L_out3$is.extreme

BiW_L_out3 <- BiW_L_out3[c(2,5,19)]


BiW_L_extreme <- full_join(BiW_L_out, BiW_L_out1, by=c('ID', 'BiW_L'))
BiW_L_extreme <- full_join(BiW_L_extreme, BiW_L_out2, by=c('ID', 'BiW_L'))
BiW_L_extreme <- full_join(BiW_L_extreme, BiW_L_out3, by=c('ID', 'BiW_L'))

BiW_L_extreme <- 
  filter(BiW_L_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )


BiW_L_extreme$extreme_overall <- as.character(BiW_L_extreme$extreme_overall)
BiW_L_extreme$extreme_race_eth <- as.character(BiW_L_extreme$extreme_race_eth)
BiW_L_extreme$extreme_gender <- as.character(BiW_L_extreme$extreme_gender)
BiW_L_extreme$extreme_age <- as.character(BiW_L_extreme$extreme_age)
           
BiW_L_extreme[is.na(BiW_L_extreme)]="Not Outlier"


#Size 12 Table TNR
flextable(BiW_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("BiW_L Extreme Outliers (mean=111.2mm)") 
#%>% set_header_labels(values = list(BiW_L = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(BiW_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("BiW_L Extreme Outliers (mean=111.2mm)") %>% 
  fit_to_width(7.5) 
#%>% set_header_labels(values = list(BiW_L = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=BiW_L))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="BiW_L Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```


```{r}
#GoSub_C
GoSub_C_out <- SA3_data2 %>% 
  identify_outliers(GoSub_C)

GoSub_C_out$extreme_overall <- GoSub_C_out$is.extreme

GoSub_C_out <- GoSub_C_out[c(1,5,19)]



GoSub_C_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(GoSub_C)

GoSub_C_out1$extreme_race_eth <- GoSub_C_out1$is.extreme

GoSub_C_out1 <- GoSub_C_out1[c(2,6,19)]




GoSub_C_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(GoSub_C)

GoSub_C_out2$extreme_gender <- GoSub_C_out2$is.extreme

GoSub_C_out2 <- GoSub_C_out2[c(2,6,19)]



GoSub_C_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(GoSub_C)

GoSub_C_out3$extreme_age <- GoSub_C_out3$is.extreme

GoSub_C_out3 <- GoSub_C_out3[c(2,6,19)]


GoSub_C_extreme <- full_join(GoSub_C_out, GoSub_C_out1, by=c('ID', 'GoSub_C'))
GoSub_C_extreme <- full_join(GoSub_C_extreme, GoSub_C_out2, by=c('ID', 'GoSub_C'))
GoSub_C_extreme <- full_join(GoSub_C_extreme, GoSub_C_out3, by=c('ID', 'GoSub_C'))

GoSub_C_extreme <- 
  filter(GoSub_C_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )

GoSub_C_extreme$extreme_overall <- as.character(GoSub_C_extreme$extreme_overall)
GoSub_C_extreme$extreme_race_eth <- as.character(GoSub_C_extreme$extreme_race_eth)
GoSub_C_extreme$extreme_gender <- as.character(GoSub_C_extreme$extreme_gender)
GoSub_C_extreme$extreme_age <- as.character(GoSub_C_extreme$extreme_age)

GoSub_C_extreme[is.na(GoSub_C_extreme)]="Not Outlier"           

#Size 12 Table TNR
flextable(GoSub_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("GoSub_C Extreme Outliers (mean=99.05mm)") 
#%>% set_header_labels(values = list(GoSub_C = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(GoSub_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("GoSub_C Extreme Outliers (mean=99.05mm)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(GoSub_C = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=GoSub_C))+
  geom_bar(stat="bin", bins=30, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="GoSub_C Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```


```{r}
#NRB_L
NRB_L_out <- SA3_data2 %>% 
  identify_outliers(NRB_L)

NRB_L_out$extreme_overall <- NRB_L_out$is.extreme

NRB_L_out <- NRB_L_out[c(1,6,19)]



NRB_L_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(NRB_L)

NRB_L_out1$extreme_race_eth <- NRB_L_out1$is.extreme

NRB_L_out1 <- NRB_L_out1[c(2,7,19)]




NRB_L_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(NRB_L)

NRB_L_out2$extreme_gender <- NRB_L_out2$is.extreme

NRB_L_out2 <- NRB_L_out2[c(2,7,19)]



NRB_L_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(NRB_L)

NRB_L_out3$extreme_age <- NRB_L_out3$is.extreme

NRB_L_out3 <- NRB_L_out3[c(2,7,19)]


NRB_L_extreme <- full_join(NRB_L_out, NRB_L_out1, by=c('ID', 'NRB_L'))
NRB_L_extreme <- full_join(NRB_L_extreme, NRB_L_out2, by=c('ID', 'NRB_L'))
NRB_L_extreme <- full_join(NRB_L_extreme, NRB_L_out3, by=c('ID', 'NRB_L'))

NRB_L_extreme <- 
  filter(NRB_L_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )

NRB_L_extreme$extreme_overall <- as.character(NRB_L_extreme$extreme_overall)
NRB_L_extreme$extreme_race_eth <- as.character(NRB_L_extreme$extreme_race_eth)
NRB_L_extreme$extreme_gender <- as.character(NRB_L_extreme$extreme_gender)
NRB_L_extreme$extreme_age <- as.character(NRB_L_extreme$extreme_age)


NRB_L_extreme[is.na(NRB_L_extreme)]="Not Outlier"           

#Size 12 Table TNR
flextable(NRB_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("NRB_L Extreme Outliers (mean=17.98mm)") 
#%>% set_header_labels(values = list(NRB_L = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(NRB_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("NRB_L Extreme Outliers (mean=17.98mm)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(NRB_L = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=NRB_L))+
  geom_bar(stat="bin", bins=25, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="NRB_L Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```



```{r}
#ProS_L
ProS_L_out <- SA3_data2 %>% 
  identify_outliers(ProS_L)

ProS_L_out$extreme_overall <- ProS_L_out$is.extreme

ProS_L_out <- ProS_L_out[c(1,7,19)]



ProS_L_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(ProS_L)

ProS_L_out1$extreme_race_eth <- ProS_L_out1$is.extreme

ProS_L_out1 <- ProS_L_out1[c(2,8,19)]




ProS_L_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(ProS_L)

ProS_L_out2$extreme_gender <- ProS_L_out2$is.extreme

ProS_L_out2 <- ProS_L_out2[c(2,8,19)]



ProS_L_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(ProS_L)

ProS_L_out3$extreme_age <- ProS_L_out3$is.extreme

ProS_L_out3 <- ProS_L_out3[c(2,8,19)]


ProS_L_extreme <- full_join(ProS_L_out, ProS_L_out1, by=c('ID', 'ProS_L'))
ProS_L_extreme <- full_join(ProS_L_extreme, ProS_L_out2, by=c('ID', 'ProS_L'))
ProS_L_extreme <- full_join(ProS_L_extreme, ProS_L_out3, by=c('ID', 'ProS_L'))

ProS_L_extreme <- 
  filter(ProS_L_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )

ProS_L_extreme$extreme_overall <- as.character(ProS_L_extreme$extreme_overall)
ProS_L_extreme$extreme_race_eth <- as.character(ProS_L_extreme$extreme_race_eth)
ProS_L_extreme$extreme_gender <- as.character(ProS_L_extreme$extreme_gender)
ProS_L_extreme$extreme_age <- as.character(ProS_L_extreme$extreme_age)

ProS_L_extreme[is.na(ProS_L_extreme)]="Not Outlier"           

#Size 12 Table TNR
flextable(ProS_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("ProS_L Extreme Outliers (mean=19.16mm)") 
#%>% set_header_labels(values = list(ProS_L = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(ProS_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("ProS_L Extreme Outliers (mean=19.16mm)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(ProS_L = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=ProS_L))+
  geom_bar(stat="bin", bins=25, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="ProS_L Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```


SelP_L
```{r}
#SelP_L
SelP_L_out <- SA3_data2 %>% 
  identify_outliers(SelP_L)

SelP_L_out$extreme_overall <- SelP_L_out$is.extreme

SelP_L_out <- SelP_L_out[c(1,8,19)]



SelP_L_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(SelP_L)

SelP_L_out1$extreme_race_eth <- SelP_L_out1$is.extreme

SelP_L_out1 <- SelP_L_out1[c(2,9,19)]




SelP_L_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(SelP_L)

SelP_L_out2$extreme_gender <- SelP_L_out2$is.extreme

SelP_L_out2 <- SelP_L_out2[c(2,9,19)]



SelP_L_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(SelP_L)

SelP_L_out3$extreme_age <- SelP_L_out3$is.extreme

SelP_L_out3 <- SelP_L_out3[c(2,9,19)]


SelP_L_extreme <- full_join(SelP_L_out, SelP_L_out1, by=c('ID', 'SelP_L'))
SelP_L_extreme <- full_join(SelP_L_extreme, SelP_L_out2, by=c('ID', 'SelP_L'))
SelP_L_extreme <- full_join(SelP_L_extreme, SelP_L_out3, by=c('ID', 'SelP_L'))

SelP_L_extreme <- 
  filter(SelP_L_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )

SelP_L_extreme$extreme_overall <- as.character(SelP_L_extreme$extreme_overall)
SelP_L_extreme$extreme_race_eth <- as.character(SelP_L_extreme$extreme_race_eth)
SelP_L_extreme$extreme_gender <- as.character(SelP_L_extreme$extreme_gender)
SelP_L_extreme$extreme_age <- as.character(SelP_L_extreme$extreme_age)

SelP_L_extreme[is.na(SelP_L_extreme)] = "Not Outlier"           

#Size 12 Table TNR
flextable(SelP_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("SelP_L Extreme Outliers (mean=44.53mm)") 
#%>% set_header_labels(values = list(SelP_L = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(SelP_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("SelP_L Extreme Outliers (mean=44.53mm)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(SelP_L = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=SelP_L))+
  geom_bar(stat="bin", bins=25, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="SelP_L Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```



```{r}
#SelM_L
SelM_L_out <- SA3_data2 %>% 
  identify_outliers(SelM_L)

SelM_L_out$extreme_overall <- SelM_L_out$is.extreme

SelM_L_out <- SelM_L_out[c(1,9,19)]



SelM_L_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(SelM_L)

SelM_L_out1$extreme_race_eth <- SelM_L_out1$is.extreme

SelM_L_out1 <- SelM_L_out1[c(2,10,19)]




SelM_L_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(SelM_L)

SelM_L_out2$extreme_gender <- SelM_L_out2$is.extreme

SelM_L_out2 <- SelM_L_out2[c(2,10,19)]



SelM_L_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(SelM_L)

SelM_L_out3$extreme_age <- SelM_L_out3$is.extreme

SelM_L_out3 <- SelM_L_out3[c(2,10,19)]


SelM_L_extreme <- full_join(SelM_L_out, SelM_L_out1, by=c('ID', 'SelM_L'))
SelM_L_extreme <- full_join(SelM_L_extreme, SelM_L_out2, by=c('ID', 'SelM_L'))
SelM_L_extreme <- full_join(SelM_L_extreme, SelM_L_out3, by=c('ID', 'SelM_L'))

SelM_L_extreme <- 
  filter(SelM_L_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )

SelM_L_extreme$extreme_overall <- as.character(SelM_L_extreme$extreme_overall)
SelM_L_extreme$extreme_race_eth <- as.character(SelM_L_extreme$extreme_race_eth)
SelM_L_extreme$extreme_gender <- as.character(SelM_L_extreme$extreme_gender)
SelM_L_extreme$extreme_age <- as.character(SelM_L_extreme$extreme_age)

SelM_L_extreme[is.na(SelM_L_extreme)] = "Not Outlier"           

#Size 12 Table TNR
flextable(SelM_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("SelM_L Extreme Outliers (mean=116.2mm)") 
#%>% set_header_labels(values = list(SelM_L = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(SelM_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("SelM_L Extreme Outliers (mean=116.2mm)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(SelM_L = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=SelM_L))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="SelM_L Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```


```{r}
#SnasM_C
SnasM_C_out <- SA3_data2 %>% 
  identify_outliers(SnasM_C)

SnasM_C_out$extreme_overall <- SnasM_C_out$is.extreme

SnasM_C_out <- SnasM_C_out[c(1,10,19)]



SnasM_C_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(SnasM_C)

SnasM_C_out1$extreme_race_eth <- SnasM_C_out1$is.extreme

SnasM_C_out1 <- SnasM_C_out1[c(2,11,19)]




SnasM_C_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(SnasM_C)

SnasM_C_out2$extreme_gender <- SnasM_C_out2$is.extreme

SnasM_C_out2 <- SnasM_C_out2[c(2,11,19)]



SnasM_C_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(SnasM_C)

SnasM_C_out3$extreme_age <- SnasM_C_out3$is.extreme

SnasM_C_out3 <- SnasM_C_out3[c(2,11,19)]


SnasM_C_extreme <- full_join(SnasM_C_out, SnasM_C_out1, by=c('ID', 'SnasM_C'))
SnasM_C_extreme <- full_join(SnasM_C_extreme, SnasM_C_out2, by=c('ID', 'SnasM_C'))
SnasM_C_extreme <- full_join(SnasM_C_extreme, SnasM_C_out3, by=c('ID', 'SnasM_C'))

SnasM_C_extreme <- 
  filter(SnasM_C_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )

SnasM_C_extreme$extreme_overall <- as.character(SnasM_C_extreme$extreme_overall)
SnasM_C_extreme$extreme_race_eth <- as.character(SnasM_C_extreme$extreme_race_eth)
SnasM_C_extreme$extreme_gender <- as.character(SnasM_C_extreme$extreme_gender)
SnasM_C_extreme$extreme_age <- as.character(SnasM_C_extreme$extreme_age)

SnasM_C_extreme[is.na(SnasM_C_extreme)] = "Not Outlier"           

#Size 12 Table TNR
flextable(SnasM_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("SnasM_C Extreme Outliers (mean=75.1mm)") 
#%>% set_header_labels(values = list(SnasM_C = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(SnasM_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("SnasM_C Extreme Outliers (mean=75.1mm)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(SnasM_C = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=SnasM_C))+
  geom_bar(stat="bin", bins=25, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="SnasM_C Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```



```{r}
#TrSman_C
TrSman_C_out <- SA3_data2 %>% 
  identify_outliers(TrSman_C)

TrSman_C_out$extreme_overall <- TrSman_C_out$is.extreme

TrSman_C_out <- TrSman_C_out[c(1,11,19)]



TrSman_C_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(TrSman_C)

TrSman_C_out1$extreme_race_eth <- TrSman_C_out1$is.extreme

TrSman_C_out1 <- TrSman_C_out1[c(2,12,19)]




TrSman_C_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(TrSman_C)

TrSman_C_out2$extreme_gender <- TrSman_C_out2$is.extreme

TrSman_C_out2 <- TrSman_C_out2[c(2,12,19)]



TrSman_C_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(TrSman_C)

TrSman_C_out3$extreme_age <- TrSman_C_out3$is.extreme

TrSman_C_out3 <- TrSman_C_out3[c(2,12,19)]


TrSman_C_extreme <- full_join(TrSman_C_out, TrSman_C_out1, by=c('ID', 'TrSman_C'))
TrSman_C_extreme <- full_join(TrSman_C_extreme, TrSman_C_out2, by=c('ID', 'TrSman_C'))
TrSman_C_extreme <- full_join(TrSman_C_extreme, TrSman_C_out3, by=c('ID', 'TrSman_C'))

TrSman_C_extreme <- 
  filter(TrSman_C_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )

TrSman_C_extreme$extreme_overall <- as.character(TrSman_C_extreme$extreme_overall)
TrSman_C_extreme$extreme_race_eth <- as.character(TrSman_C_extreme$extreme_race_eth)
TrSman_C_extreme$extreme_gender <- as.character(TrSman_C_extreme$extreme_gender)
TrSman_C_extreme$extreme_age <- as.character(TrSman_C_extreme$extreme_age)

TrSman_C_extreme[is.na(TrSman_C_extreme)] = "Not Outlier"           

#Size 12 Table TNR
flextable(TrSman_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("TrSman_C Extreme Outliers (mean=153.4mm)") 
#%>% set_header_labels(values = list(TrSman_C = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(TrSman_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("TrSman_C Extreme Outliers (mean=153.4mm)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(TrSman_C = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=TrSman_C))+
  geom_bar(stat="bin", bins=30, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="TrSman_C Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```


```{r}
#TrTr_C
TrTr_C_out <- SA3_data2 %>% 
  identify_outliers(TrTr_C)

TrTr_C_out$extreme_overall <- TrTr_C_out$is.extreme

TrTr_C_out <- TrTr_C_out[c(1,12,19)]



TrTr_C_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(TrTr_C)

TrTr_C_out1$extreme_race_eth <- TrTr_C_out1$is.extreme

TrTr_C_out1 <- TrTr_C_out1[c(2,13,19)]




TrTr_C_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(TrTr_C)

TrTr_C_out2$extreme_gender <- TrTr_C_out2$is.extreme

TrTr_C_out2 <- TrTr_C_out2[c(2,13,19)]



TrTr_C_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(TrTr_C)

TrTr_C_out3$extreme_age <- TrTr_C_out3$is.extreme

TrTr_C_out3 <- TrTr_C_out3[c(2,13,19)]


TrTr_C_extreme <- full_join(TrTr_C_out, TrTr_C_out1, by=c('ID', 'TrTr_C'))
TrTr_C_extreme <- full_join(TrTr_C_extreme, TrTr_C_out2, by=c('ID', 'TrTr_C'))
TrTr_C_extreme <- full_join(TrTr_C_extreme, TrTr_C_out3, by=c('ID', 'TrTr_C'))

TrTr_C_extreme <- 
  filter(TrTr_C_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )

TrTr_C_extreme$extreme_overall <- as.character(TrTr_C_extreme$extreme_overall)
TrTr_C_extreme$extreme_race_eth <- as.character(TrTr_C_extreme$extreme_race_eth)
TrTr_C_extreme$extreme_gender <- as.character(TrTr_C_extreme$extreme_gender)
TrTr_C_extreme$extreme_age <- as.character(TrTr_C_extreme$extreme_age)

TrTr_C_extreme[is.na(TrTr_C_extreme)] = "Not Outlier"           

#Size 12 Table TNR
flextable(TrTr_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("TrTr_C Extreme Outliers (mean=282.7)") 
#%>% set_header_labels(values = list(TrTr_C = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(TrTr_C_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("TrTr_C Extreme Outliers (mean=282.7)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(TrTr_C = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=TrTr_C))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="TrTr_C Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```



```{r}
#TrTr_L
TrTr_L_out <- SA3_data2 %>% 
  identify_outliers(TrTr_L)

TrTr_L_out$extreme_overall <- TrTr_L_out$is.extreme

TrTr_L_out <- TrTr_L_out[c(1,13,19)]



TrTr_L_out1 <- SA3_data2 %>% 
  group_by(race_eth) %>% 
  identify_outliers(TrTr_L)

TrTr_L_out1$extreme_race_eth <- TrTr_L_out1$is.extreme

TrTr_L_out1 <- TrTr_L_out1[c(2,14,19)]




TrTr_L_out2 <- SA3_data2 %>% 
  group_by(gender) %>% 
  identify_outliers(TrTr_L)

TrTr_L_out2$extreme_gender <- TrTr_L_out2$is.extreme

TrTr_L_out2 <- TrTr_L_out2[c(2,14,19)]



TrTr_L_out3 <- SA3_data2 %>% 
  group_by(age_group) %>% 
  identify_outliers(TrTr_L)

TrTr_L_out3$extreme_age <- TrTr_L_out3$is.extreme

TrTr_L_out3 <- TrTr_L_out3[c(2,14,19)]


TrTr_L_extreme <- full_join(TrTr_L_out, TrTr_L_out1, by=c('ID', 'TrTr_L'))
TrTr_L_extreme <- full_join(TrTr_L_extreme, TrTr_L_out2, by=c('ID', 'TrTr_L'))
TrTr_L_extreme <- full_join(TrTr_L_extreme, TrTr_L_out3, by=c('ID', 'TrTr_L'))

TrTr_L_extreme <- 
  filter(TrTr_L_extreme, 
           extreme_overall == "TRUE" | 
           extreme_race_eth == "TRUE" |
           extreme_gender == "TRUE" |
           extreme_age == "TRUE" )

TrTr_L_extreme$extreme_overall <- as.character(TrTr_L_extreme$extreme_overall)
TrTr_L_extreme$extreme_race_eth <- as.character(TrTr_L_extreme$extreme_race_eth)
TrTr_L_extreme$extreme_gender <- as.character(TrTr_L_extreme$extreme_gender)
TrTr_L_extreme$extreme_age <- as.character(TrTr_L_extreme$extreme_age)

TrTr_L_extreme[is.na(TrTr_L_extreme)] = "Not Outlier"           

#Size 12 Table TNR
flextable(TrTr_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("TrTr_L Extreme Outliers (mean=146.5mm)") 
#%>% set_header_labels(values = list(TrTr_L = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(TrTr_L_extreme) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("TrTr_L Extreme Outliers (mean=146.5mm)") %>% 
  fit_to_width(7.5) %>% 
  autofit
#%>% set_header_labels(values = list(TrTr_L = "Alare/AlareCont"))

ggplot(data=SA3_data2, aes(x=TrTr_L))+
  geom_bar(stat="bin", bins=20, color= "black", fill = "white")+
  theme_bw() + theme(text=element_text(family= "Times New Roman"))+
  labs(title="TrTr_L Measurement Distribution",
       subtitle = "NA values removed",
       y="Frequency",
       x="Measurement in mm")
```



```{r}
##outliers
mult_out <- SA3_data2


#cutoff <- qchisq(1-.001, ncol(mult_out[ , -c(1,14,15,16)]))


mult_out$mahal <- mahalanobis(mult_out[ , -c(1,14,15,16)],
                    colMeans(mult_out[ , -c(1,14,15,16)]),
                    cov(mult_out[ , -c(1,14,15,16)]))

mult_out$p <- pchisq(mult_out$mahal, df=11, lower.tail=FALSE)



mult_out$multv_outlier <- with(mult_out, ifelse(p < 0.001, 'TRUE', 'FALSE'))

mult_out <- mult_out %>% 
  filter(multv_outlier == TRUE)


##df
#summary(mahal < cutoff)

#mult_out2 <- SA3_data2 %>%
 #mahalanobis_distance() %>%
 #filter(is.outlier == TRUE) %>%
  #as.data.frame()

#mult_out2

##exclude outliers
#noout = subset(nomiss, mahal < cutoff)
```


```{r}
AA_C_extreme$offending <- "AA_C univar"
BiW_C_extreme$offending <- "BiW_C univar"
BiW_L_extreme$offending <- "BiW_L univar"
GoSub_C_extreme$offending <- "GoSub_C univar"
NRB_L_extreme$offending <- "NRB_L univar"
ProS_L_extreme$offending <- "ProS_L univar"
SelP_L_extreme$offending <- "SelP_L univar"
SelM_L_extreme$offending <- "SelM_L univar"
SnasM_C_extreme$offending <- "SnasM_C univar"
TrSman_C_extreme$offending <- "TrSman_C univar"
TrTr_C_extreme$offending <- "TrTr_C univar"
TrTr_L_extreme$offending <- "TrTr_L univar"
```


```{r}
all_extreme <- full_join(AA_C_extreme, BiW_C_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, BiW_L_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, GoSub_C_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, NRB_L_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, ProS_L_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, SelP_L_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, SelM_L_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, SnasM_C_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, TrSman_C_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, TrTr_C_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))

all_extreme <- full_join(all_extreme, TrTr_L_extreme, by=c('ID', 
                                                        'extreme_overall', 
                                                        'extreme_race_eth', 
                                                        'extreme_gender',
                                                        'extreme_age',
                                                        'offending'))
```




```{r}
combin_out <- full_join(mult_out, all_extreme, by=c('ID'))

str(combin_out)
```

```{r}

combin_out1 <- combin_out[c(1,19,21,22,23,24,25)]

combin_out1$offending[is.na(combin_out1$offending)] = "Not Univar Outlier" 

combin_out1[is.na(combin_out1)] = "Not Outlier"  

str(combin_out1)
```

```{r}

combin_out1$multv_outlier <- factor(combin_out1$multv_outlier, levels = c("TRUE", "FALSE", "Not Outlier"))
combin_out1$extreme_overall <- factor(combin_out1$extreme_overall, levels = c("TRUE", "FALSE", "Not Outlier"))
combin_out1$extreme_race_eth <- factor(combin_out1$extreme_race_eth, levels = c("TRUE", "FALSE", "Not Outlier"))
combin_out1$extreme_gender <- factor(combin_out1$extreme_gender, levels = c("TRUE", "FALSE", "Not Outlier"))
combin_out1$extreme_age <- factor(combin_out1$extreme_age, levels = c("TRUE", "FALSE", "Not Outlier"))


arrange(combin_out1, multv_outlier + extreme_overall)
#combin_out1[with(combin_out1, order("multv_outlier", "extreme_overall", "extreme_race_eth", "extreme_gender", "extreme_age")), ]
```



```{r}
#Size 12 Table TNR
flextable(combin_out1) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("Univariate and Multivariate Outlier Status") %>% 
  autofit
#%>% set_header_labels(values = list(TrTr_L = "Alare/AlareCont"))

#Autofit Width Table TNR
flextable(combin_out1) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("Univariate and Multivariate Outlier Status") %>% 
  autofit() %>% 
  fit_to_width(7.5)
  
#%>% set_header_labels(values = list(TrTr_L = "Alare/AlareCont"))
```


```{r}

##exclude outliers
SA3_noout <- anti_join(SA3_data2, mult_out, by="ID")

1710-19

str(SA3_noout)
```


```{r}
write_xlsx(SA3_noout, "C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\SA3_noout.xlsx")
```

