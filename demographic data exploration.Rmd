---
title: "data exploration"
output:
   pdf_document:
     latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(knitr)
library(kableExtra)
library(devtools)
library(huxtable)
options(huxtable.latex_use_fontspec = TRUE)
```


```{r}
load(file="headscan_full")
```

```{r}
headscan_full %>%
      head() %>%
      as_huxtable() %>% 
      set_font("Times New Roman")
```


```{r}
age_sumstats <- headscan_full %>% 
  summarise(n = n(),
            min = min(age, na.rm = TRUE),
            max = max(age, na.rm = TRUE),
            mean = mean(age, na.rm = TRUE),
            sd = sd(age, na.rm = TRUE),
            se = sd/sqrt(n),
            quant5th = quantile(age, 0.05, na.rm=TRUE),
            quant25th = quantile(age, 0.25, na.rm=TRUE),
            quant50th = quantile(age, 0.50, na.rm=TRUE),
            quant75th = quantile(age, 0.75, na.rm=TRUE),
            quant95th = quantile(age, 0.95, na.rm=TRUE),
            na = sum(is.na(age)))

age_sumstats <- age_sumstats %>% 
  mutate(across(where(is.numeric), round, 2))
            
age_sumstats %>% 
  kbl(caption = "Age SumStats") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = TRUE)
```

```{r}
raceage_sumstats <- headscan_full %>% 
  group_by(race_eth) %>% 
  summarise(n = n(),
            min = min(age, na.rm = TRUE),
            max = max(age, na.rm = TRUE),
            mean = mean(age, na.rm = TRUE),
            sd = sd(age, na.rm = TRUE),
            se = sd/sqrt(n),
            quant5th = quantile(age, 0.05, na.rm=TRUE),
            quant25th = quantile(age, 0.25, na.rm=TRUE),
            quant50th = quantile(age, 0.50, na.rm=TRUE),
            quant75th = quantile(age, 0.75, na.rm=TRUE),
            quant95th = quantile(age, 0.95, na.rm=TRUE),
            na = sum(is.na(age)))

raceage_sumstats <- raceage_sumstats %>% 
  mutate(across(where(is.numeric), round, 2))
            
raceage_sumstats %>% 
  kbl(caption = "Age SumStats by Race/Ethnicity") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = TRUE)
```

```{r}
genderage_sumstats <- headscan_full %>% 
  group_by(gender) %>% 
  summarise(n = n(),
            min = min(age, na.rm = TRUE),
            max = max(age, na.rm = TRUE),
            mean = mean(age, na.rm = TRUE),
            sd = sd(age, na.rm = TRUE),
            se = sd/sqrt(n),
            quant5th = quantile(age, 0.05, na.rm=TRUE),
            quant25th = quantile(age, 0.25, na.rm=TRUE),
            quant50th = quantile(age, 0.50, na.rm=TRUE),
            quant75th = quantile(age, 0.75, na.rm=TRUE),
            quant95th = quantile(age, 0.95, na.rm=TRUE),
            na = sum(is.na(age)))

genderage_sumstats <- genderage_sumstats %>% 
  mutate(across(where(is.numeric), round, 2))
            
genderage_sumstats %>% 
  kbl(caption = "Age SumStats by Gender") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = TRUE)
```
```{r}
agegroup_sumstats <- headscan_full %>% 
  group_by(age_group) %>% 
  summarise(n = n(),
            min = min(age, na.rm = TRUE),
            max = max(age, na.rm = TRUE),
            mean = mean(age, na.rm = TRUE),
            sd = sd(age, na.rm = TRUE),
            se = sd/sqrt(n),
            quant5th = quantile(age, 0.05, na.rm=TRUE),
            quant25th = quantile(age, 0.25, na.rm=TRUE),
            quant50th = quantile(age, 0.50, na.rm=TRUE),
            quant75th = quantile(age, 0.75, na.rm=TRUE),
            quant95th = quantile(age, 0.95, na.rm=TRUE),
            na = sum(is.na(age)))

agegroup_sumstats <- agegroup_sumstats %>% 
  mutate(across(where(is.numeric), round, 2))
            
agegroup_sumstats %>% 
  kbl(caption = "Age SumStats by Age Group") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = TRUE)
```

```{r}
#explore race_eth, frequency of each

```

```{r}
#explore gender, frequency of each
```












PLOTS










```{r, fig.width= 7, fig.height=4}
ggplot(data=headscan_full, aes(x= age, fill=gender))+
  scale_fill_grey(na.value="gray90")+
  geom_histogram(binwidth = 3)+
  labs(title="Headscan Sample Demographics: Age",
       subtitle="sorted by Race/Ethnicity, color by Gender",
       y="Count (variable scale per group)",
       x="Age",
       fill="Gender")+
  facet_wrap(~race_eth, scales="free_y")+
  scale_y_continuous(breaks = function(x) unique(floor(pretty(seq(0, (max(x) + 1) * 1.1)))))+
  geom_vline(xintercept = 37, color="red", linetype= "dashed")+
  geom_vline(xintercept = 55, color="red", linetype= "dashed")
  
```

```{r}
#ggplot(data=headscan_full)+
  #geom_histogram(binwidth=2, aes(x=age, fill=race_eth))+
  #scale_fill_grey()+
  #labs(title= "Demographics of Headscan Sample",
       #subtitle = "Data collected by Human Solutions",
       #fill= "Ethnicity",
       #y="Count",
       #x="Age")
```
```{r}
#ggplot(data=headscan_full)+
  #geom_boxplot(aes(x=race_eth, y=age, fill=gender))+
  #scale_fill_grey()+
  #theme(axis.text.x = element_text(angle = 45))
```