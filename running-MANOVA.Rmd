---
title: "running-MANOVA"
output: html_document
date: "2022-09-15"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(tidyverse)
library(readxl)
library(officer)
library(flextable)
library(extrafont)
library(writexl)
library(rstatix)
library(corrr)
library(corrplot)
library(car)
library(heplots)
library(broom)
library(emmeans)
```

```{r}
#times new roman tables
my_ft_theme <- function(ft, ...) {
  # Remove vertical cell padding
  ft <- padding(ft, padding.top = 0, padding.bottom = 0, part = "all")
  
  # Change font to TNR 11
  ft <- font(ft, fontname = "Times New Roman", part = "all")
  ft <- fontsize(ft, part = "all", size = 12)
  ft
}
```

```{r}

chosen_nona1 <- read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\chosen_nona1.xlsx")

variables <- cbind(chosen_nona1$AA_C, chosen_nona1$BiW_C, chosen_nona1$BiW_L, 
                   chosen_nona1$GoSub_C, chosen_nona1$NRB_L, chosen_nona1$ProS_L,
                   chosen_nona1$SelP_L, chosen_nona1$SelM_L, chosen_nona1$SnasM_C,
                   chosen_nona1$TrSman_C, chosen_nona1$TrTr_C, chosen_nona1$TrTr_L)
```

#https://www.hindawi.com/journals/cmmm/2019/2173638/ 
Use Pillai! better for when we don't know enough about covariance

#https://www.sagepub.com/sites/default/files/upm-assets/9761_book_item_9761.pdf
Type III sum of squares can be used in models where there are uneven group sizes, although there needs to be at least one participant in each cell. It calculates the sum of squares after the independent variables have all been adjusted for the inclusion of all other independent variables in the model


```{r}
output<-lm(variables ~ gender+race_eth+age_group, data=chosen_nona1,
           contrasts = list(gender=contr.sum, race_eth=contr.sum, age_group=contr.sum))

manova_out_nona1 <- Manova(output, type="III")

summary(manova_out_nona1)
```


```{r}
output1<-manova(variables ~ gender+race_eth+age_group, data=chosen_nona1)

#type 3 and type 1 give same Pillai values

summary(output1)
```


```{r}
output2<-as.data.frame(tidy(output1))

output2$p.value <- formatC(output2$p.value, format = "e")

output2 <- rename(output2, f.statistic = statistic)

#Autofit Width Table TNR
flextable(output2) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("Additive MANOVA Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```

From 511 notes: 

The experimentwise error rate (EER) is the probability of having at
least one false rejection in the group of tests from a single experiment
or study. The “experiment” is the ANOVA analysis.


John Tukey proposed a method that can be used to run all pairwise
comparisons while controlling EER.

Tukey ME > Unadj ME, hence we will find evidence of fewer
differences (or weaker evidence of differences) using Tukey’s
method.


```{r}
AA_Cout <- aov(AA_C ~ gender+race_eth+age_group, data=chosen_nona1)
summary(AA_Cout)
AA_Cout_data <- as.data.frame(tidy(AA_Cout))
```

```{r}
AA_Cout_data <- rename(AA_Cout_data, f.statistic = statistic)
AA_Cout_data$p.value <- formatC(AA_Cout_data$p.value, format = "e")

#Autofit Width Table TNR
flextable(AA_Cout_data) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("AA_C Additive Anova Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```


```{r}
emmeans(AA_Cout, ~ gender)
emmip(AA_Cout, ~ gender)
```
```{r}
emmeans(AA_Cout, ~ race_eth)
emmip(AA_Cout, ~ race_eth)
```
```{r}
emmeans(AA_Cout, ~ age_group)
emmip(AA_Cout, ~ age_group)
```




```{r}
BiW_Lout <- aov(BiW_L ~ gender+race_eth+age_group, data=chosen_nona1)
summary(BiW_Lout)
BiW_Lout_data <- as.data.frame(tidy(BiW_Lout))
```

```{r}
BiW_Lout_data <- rename(BiW_Lout_data, f.statistic = statistic)
BiW_Lout_data$p.value <- formatC(BiW_Lout_data$p.value, format = "e")

#Autofit Width Table TNR
flextable(BiW_Lout_data) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("BiW_L Additive Anova Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```


```{r}
BiW_Lem <- emmeans(BiW_Lout, ~ gender)
BiW_Lem1 <- as.data.frame(BiW_Lem)

BiW_Lem 

flextable(BiW_Lem1) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("Estimated Marginal Means: BiW_L and Gender") %>% 
  fit_to_width(7.5) %>% 
  autofit()


BiW_Lem2 <- pairs(BiW_Lem, adjust="Tukey")
BiW_Lem3 <- as.data.frame(BiW_Lem2)


BiW_Lem3$p.value <- formatC(BiW_Lem3$p.value, format = "e")

BiW_Lem2

flextable(BiW_Lem3) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("Tukey Pairwise Comparisons: BiW_L and Gender") %>% 
  fit_to_width(7.5) %>% 
  autofit()


emmip_BiW_Lg <- emmip(BiW_Lout, ~ gender, CIs = TRUE)

emmip_BiW_Lg + 
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="BiW_L and Gender: Estimated Marginal Means Plot",
       subtitle="With Confidence Intervals",
       y="Linear Prediction (of measurement in mm)",
       x="Levels of Gender")

BiW_Lem1 %>% 
  ggplot(aes(x=gender, y=emmean))+
  geom_bar(stat= "identity", color= "black", fill = "white")+
  geom_errorbar(ymin=BiW_Lem1$lower.CL, ymax=BiW_Lem1$upper.CL)+
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="BiW_L and Gender: Estimated Marginal Means Plot",
       subtitle="With Confidence Intervals",
       y="Linear Prediction (of measurement in mm)",
       x="Levels of Gender")
  
```


```{r}
emmeans(BiW_Lout, ~ race_eth)
emmip(BiW_Lout, ~ race_eth)
```
```{r}
emmeans(BiW_Lout, ~ age_group)
emmip(BiW_Lout, ~ age_group)
```


```{r}
BiW_Cout <- aov(BiW_C ~ gender+race_eth+age_group, data=chosen_nona1)
summary(BiW_Cout)
BiW_Cout_data <- as.data.frame(tidy(BiW_Cout))
```

```{r}
BiW_Cout_data <- rename(BiW_Cout_data, f.statistic = statistic)
BiW_Cout_data$p.value <- formatC(BiW_Cout_data$p.value, format = "e")

#Autofit Width Table TNR
flextable(BiW_Cout_data) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("BiW_C Additive Anova Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```


```{r}
emmeans(BiW_Cout, ~ gender)
emmip(BiW_Cout, ~ gender)
```
```{r}
emmeans(BiW_Cout, ~ race_eth)
emmip(BiW_Cout, ~ race_eth)
```


```{r}
GoSub_Cout <- aov(GoSub_C ~ gender+race_eth+age_group, data=chosen_nona1)
summary(GoSub_Cout)
GoSub_Cout_data <- as.data.frame(tidy(GoSub_Cout))
```

```{r}
GoSub_Cout_data <- rename(GoSub_Cout_data, f.statistic = statistic)
GoSub_Cout_data$p.value <- formatC(GoSub_Cout_data$p.value, format = "e")

#Autofit Width Table TNR
flextable(GoSub_Cout_data) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("GoSub_C Additive Anova Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```


```{r}
emmeans(GoSub_Cout, ~ gender)
emmip(GoSub_Cout, ~ gender)
```
```{r}
emmeans(GoSub_Cout, ~ race_eth)
emmip(GoSub_Cout, ~ race_eth)
```
```{r}
emmeans(GoSub_Cout, ~ age_group)
emmip(GoSub_Cout, ~ age_group)
```



```{r}
NRB_Lout <- aov(NRB_L ~ gender+race_eth+age_group, data=chosen_nona1)
summary(NRB_Lout)
NRB_Lout_data <- as.data.frame(tidy(NRB_Lout))
```

```{r}
NRB_Lout_data <- rename(NRB_Lout_data, f.statistic = statistic)
NRB_Lout_data$p.value <- formatC(NRB_Lout_data$p.value, format = "e")

#Autofit Width Table TNR
flextable(NRB_Lout_data) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("NRB_L Additive Anova Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```


```{r}
emmeans(NRB_Lout, ~ gender)
emmip(NRB_Lout, ~ gender)
```
```{r}
emmeans(NRB_Lout, ~ race_eth)
emmip(NRB_Lout, ~ race_eth)
```



```{r}
ProS_Lout <- aov(ProS_L ~ gender+race_eth+age_group, data=chosen_nona1)
summary(ProS_Lout)
ProS_Lout_data <- as.data.frame(tidy(ProS_Lout))
```

```{r}
ProS_Lout_data <- rename(ProS_Lout_data, f.statistic = statistic)
ProS_Lout_data$p.value <- formatC(ProS_Lout_data$p.value, format = "e")

#Autofit Width Table TNR
flextable(ProS_Lout_data) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("ProS_L Additive Anova Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```


```{r}
emmeans(ProS_Lout, ~ gender)
emmip(ProS_Lout, ~ gender)
```
```{r}
emmeans(ProS_Lout, ~ race_eth)
emmip(ProS_Lout, ~ race_eth)
```
```{r}
emmeans(ProS_Lout, ~ age_group)
emmip(ProS_Lout, ~ age_group)
```


```{r}
SelP_Lout <- aov(SelP_L ~ gender+race_eth+age_group, data=chosen_nona1)
summary(SelP_Lout)
SelP_Lout_data <- as.data.frame(tidy(SelP_Lout))
```

```{r}
SelP_Lout_data <- rename(SelP_Lout_data, f.statistic = statistic)
SelP_Lout_data$p.value <- formatC(SelP_Lout_data$p.value, format = "e")

#Autofit Width Table TNR
flextable(SelP_Lout_data) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("SelP_L Additive Anova Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```


```{r}
emmeans(SelP_Lout, ~ gender)
emmip(SelP_Lout, ~ gender)
```
```{r}
emmeans(SelP_Lout, ~ race_eth)
emmip(SelP_Lout, ~ race_eth)
```
```{r}
emmeans(SelP_Lout, ~ age_group)
emmip(SelP_Lout, ~ age_group)
```



```{r}
SelM_Lout <- aov(SelM_L ~ gender+race_eth+age_group, data=chosen_nona1)
summary(SelM_Lout)
SelM_Lout_data <- as.data.frame(tidy(SelM_Lout))
```

```{r}
SelM_Lout_data <- rename(SelM_Lout_data, f.statistic = statistic)
SelM_Lout_data$p.value <- formatC(SelM_Lout_data$p.value, format = "e")

#Autofit Width Table TNR
flextable(SelM_Lout_data) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("SelM_L Additive Anova Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```


```{r}
emmeans(SelM_Lout, ~ gender)
emmip(SelM_Lout, ~ gender)
```
```{r}
emmeans(SelM_Lout, ~ race_eth)
emmip(SelM_Lout, ~ race_eth)
```
```{r}
emmeans(SelM_Lout, ~ age_group)
emmip(SelM_Lout, ~ age_group)
```



```{r}
SnasM_Cout <- aov(SnasM_C ~ gender+race_eth+age_group, data=chosen_nona1)
summary(SnasM_Cout)
SnasM_Cout_data <- as.data.frame(tidy(SnasM_Cout))
```

```{r}
SnasM_Cout_data <- rename(SnasM_Cout_data, f.statistic = statistic)
SnasM_Cout_data$p.value <- formatC(SnasM_Cout_data$p.value, format = "e")

#Autofit Width Table TNR
flextable(SnasM_Cout_data) %>%
  my_ft_theme()%>% 
  bold(part = "header") %>% 
  set_caption("SnasM_C Additive Anova Model Findings") %>% 
  fit_to_width(7.5) %>% 
  autofit()
```


```{r}
emmeans(SnasM_Cout, ~ gender)
emmip(SnasM_Cout, ~ gender)
```
```{r}
emmeans(SnasM_Cout, ~ race_eth)
emmip(SnasM_Cout, ~ race_eth)
```


