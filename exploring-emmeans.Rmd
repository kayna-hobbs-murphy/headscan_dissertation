---
title: "exploring-emmeans"
output: html_document
date: "2022-09-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(readxl)
library(flextable)
library(extrafont)
```


```{r}
#times new roman tables
my_ft_theme <- function(ft, ...) {
  # Remove vertical cell padding
  ft <- padding(ft, padding.top = 0, padding.bottom = 0, part = "all")
  
  # Change font to TNR 11
  ft <- font(ft, fontname = "Times New Roman", part = "all")
  ft <- fontsize(ft, part = "all", size = 12)
  ft
}
```


```{r}
gender_means_data <- read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\gender_means_data.xlsx")

race_means_data <- read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\race_means_data.xlsx")

age_means_data <- read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\age_means_data.xlsx")


gender_est_data <- read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\gender_est_data.xlsx")

race_est_data <- read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\race_est_data.xlsx")

age_est_data <- read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\age_est_data.xlsx")
```


```{r}
gender_means_data %>% 
  ggplot(aes(x=gender, y=emmean, color=measure))+
  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL))+
  geom_line()+
  geom_point()+
  facet_wrap(~measure)
```
```{r}
gender_means_data$measure <- fct_reorder(gender_means_data$measure, gender_means_data$emmean, .desc=FALSE)

gender_means_data %>% 
  ggplot(aes(x=measure, y=emmean, color=gender))+
  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL))+
  geom_line()+
  geom_point()+
  facet_wrap(~gender)
```

```{r}

#gender_means_data$measure <- fct_reorder(gender_means_data$measure, gender_means_data$emmean, .desc=FALSE)

gender_means_data %>% 
  ggplot(aes(x=gender, y=emmean, fill=measure))+
  geom_bar(position=position_dodge(), stat="identity")+
  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=position_dodge(0.9))
```

```{r}

#gender_means_data$measure <- fct_reorder(gender_means_data$measure, gender_means_data$emmean, .desc=FALSE)

gender_means_data %>% 
  ggplot(aes(x=measure, y=emmean, fill=gender))+
  geom_bar(position=position_dodge(), stat="identity")+
  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=position_dodge(0.9))
```

```{r}
gender_means_data1 <- gender_means_data %>% 
  filter(gender != "Other")

gender_means_data1$measure <- fct_reorder(gender_means_data1$measure, gender_means_data1$emmean, .desc=FALSE)

gender_means_data1 %>% 
  ggplot(aes(x=measure, y=emmean, fill=gender))+
  geom_bar(position=position_dodge(), stat="identity")+
  geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=position_dodge(0.9))
```


```{r}
sig_gender_est <- gender_est_data %>% 
  filter(signif=="TRUE")


```


```{r}
sig_gender_est %>% 
  ggplot(aes(x=estimate, y= measure, fill=contrast))+
  geom_bar(position=position_dodge(), stat="identity")
```

```{r}
f_minus_m <- sig_gender_est %>% 
  filter(contrast == "Female - Male")
```


```{r}
chosen_nona1 <- read_excel("C:\\Users\\19177\\OneDrive - Colostate\\Desktop\\Dissertation\\headscan_dissertation\\chosen_nona1.xlsx")
```

```{r}
chosennona1_num <- select_if(chosen_nona1, is.numeric)
```

```{r}
measure_means <- colMeans(chosennona1_num)
measure_means <- as.data.frame(measure_means)
measure_means <- rownames_to_column(measure_means)

measure_means <- measure_means %>% 
  rename(measure=rowname)
```

```{r}
f_minus_m <- full_join(f_minus_m, measure_means, by="measure")
```

```{r}
f_minus_m$prop_diff <- (f_minus_m$estimate/f_minus_m$measure_means)
f_minus_m$percent_diff <- (f_minus_m$estimate/f_minus_m$measure_means) *100
```

```{r}
m_minus_f <- f_minus_m

m_minus_f$estimate <- m_minus_f$estimate*(-1)
m_minus_f$prop_diff <- m_minus_f$prop_diff*(-1)
m_minus_f$percent_diff <- m_minus_f$percent_diff*(-1)

m_minus_f$contrastx <- "Male - Female"
```




```{r}
f_minus_m$measure <- fct_reorder(f_minus_m$measure, f_minus_m$estimate, .desc=FALSE)

f_minus_m %>% 
  ggplot(aes(x=estimate, y= measure))+
  geom_bar(stat="identity", color= "black", fill = "white")+
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="Female - Male Significant Differences in Estimated Marginal Means",
       subtitle= "Tukey significance level 0.05",
       y="Measurement Location",
       x="Difference in mm")
```


```{r}
m_minus_f$measure <- fct_reorder(m_minus_f$measure, m_minus_f$estimate, .desc=TRUE)

m_minus_f %>% 
  ggplot(aes(x=estimate, y= measure))+
  geom_bar(stat="identity", color= "black", fill = "white")+
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="Male - Female Significant Differences in Estimated Marginal Means",
       subtitle= "Tukey significance level 0.05",
       y="Measurement Location",
       x="Difference in mm")
```




```{r}
f_minus_m$measure <- fct_reorder(f_minus_m$measure, f_minus_m$prop_diff, .desc=FALSE)

f_minus_m %>% 
  ggplot(aes(x=prop_diff, y= measure))+
  geom_bar(stat="identity", color= "black", fill = "white")+
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="Female - Male Significant Differences (as Proportion of Measurement Mean)",
       subtitle= "Tukey significance level 0.05",
       y="Measurement Location",
       x="Proportion = Estimated Marginal Mean/Measure Mean")
```


```{r}
m_minus_f$measure <- fct_reorder(m_minus_f$measure, m_minus_f$prop_diff, .desc=TRUE)

m_minus_f %>% 
  ggplot(aes(x=prop_diff, y= measure))+
  geom_bar(stat="identity", color= "black", fill = "white")+
  theme_bw()+theme(text=element_text(family= "Times New Roman"))+
  labs(title="Male - Female Significant Differences (as Proportion of Measurement Mean)",
       subtitle= "Tukey significance level 0.05",
       y="Measurement Location",
       x="Proportion = Estimated Marginal Mean/Measure Mean")
```




